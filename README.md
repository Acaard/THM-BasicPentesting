# Basic Pentesting on [hackthebox](https://tryhackme.com)

Written by: Mustafa Musallati.

---

### Enumeration:

nmap scan result:
```
sudo nmap -sC -sV -O -T4 <target ip>
[sudo] password for kali: 
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-08 04:50 EDT
Nmap scan report for 10.10.66.229
Host is up (0.089s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ï¿½   Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94%E=4%D=9/8%OT=22%CT=1%CU=38557%PV=Y%DS=2%DC=I%G=Y%TM=64FAE075
OS:%P=x86_64-pc-linux-gnu)SEQ(SP=100%GCD=1%ISR=10C%TI=Z%CI=I%II=I%TS=8)SEQ(
OS:SP=FC%GCD=1%ISR=10D%TI=Z%CI=I%II=I%TS=8)SEQ(SP=FD%GCD=1%ISR=10D%TI=Z%CI=
OS:I%II=I%TS=8)SEQ(SP=FE%GCD=1%ISR=10B%TI=Z%CI=I%II=I%TS=8)OPS(O1=M509ST11N
OS:W6%O2=M509ST11NW6%O3=M509NNT11NW6%O4=M509ST11NW6%O5=M509ST11NW6%O6=M509S
OS:T11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN(R=Y%DF=Y%T=4
OS:0%W=6903%O=M509NNSNW6%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(
OS:R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%
OS:W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=
OS:)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%
OS:UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 2 hops
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m03s, deviation: 2h18m34s, median: 2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2023-09-08T04:51:01-04:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2023-09-08T08:51:01
|_  start_date: N/A

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 29.31 seconds
```

Let's see what do we have on the website:

![](./images/20230908120850.png)

noting useful in the home page....

Let's try to enumerate through directories to see if we can find any hidden thing.

using gobuster and this command:

```
gobuster dir -u http://<target ip> -w /usr/share/wordlist/dirbuster/directory-list-1.0.txt

dir: is the directory bruteforcing mode in gobuster.
-u: to specify the url:
-w: to specify the wordlist.
```


we got a result:

![](./images/20230908121200.png)

lets go into that "development" directory and see what can we find..


![](./images/20230908121300.png)

we have some developers notes, so lets go through them


dev.txt:
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

j.txt:
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```


Reading the notes got us to know that user "j" has a weak password, so let's try brute forcing the password, but we have to know the username first, so lets see the smb port:

First Let's list the shares that are available on the target server using:
```
smbclient -L <target ip>

-L: to list the shares on the target ip
```

Since we are logged in with our machine username (because smb requires you to login with a username) but we don't have a password, after we are prompted to enter the password, basically leave it blank so we can connect either as anonymous or as guest. 

![](./images/20230908141726.png)

Let's see what files do we have on the Anonymous share using:

```
smbclient \\\\<target ip>\\Anonymous

noet: this syntax is beecause its smbclient which is used to connect to windows,if you're not familiar read about smb and how it works between windows and linux
```

![](./images/20230908142510.png)

After listing the files we have an interesting one, the staff.txt file so lets download it using "get" and maybe we get the username.

![](./images/20230908142622.png)

If you remember the user with weak password starts with J so as we can see its jan!!

time to brute-force its password via ssh using hydra.

```
hydra -l jan -P /usr/share/wordlists/rockyou.txt <target ip> ssh

-l: to specify the username.
-P: to specify the password wordlist.
```

We found a password!

![](./images/20230908152844.png)



We logged in with what we found and we have access!

![](./images/20230908153004.png)

So time for privilege escalation.

Firstly lets run sudo -l to see what commands can we run as sudo:

![](./images/20230908153153.png)

Apparently none....

After enumerating a bit in the system and seeing the home directories for available users, we see kay: 

![](./images/20230908153310.png)
Also it's the second user that was communicating in the development notes.


Upon trying to brute-force his password, we weren't able to, but let's see if we can go into his home directory.

![](./images/20230908153441.png)

We are not able to read the "pass.bak" file, but if you are familiar with ssh you will know that we don't need password to log in, we can use pub/priv keys! so let's see the .ssh  directory.


![](./images/20230908160346.png)
The "id_rsa" file is the private key used to connect via ssh without password, so lets copy it and try using it.

![](./images/20230908160536.png)

We downloaded the file to our local machine, now lets set it to read only (it is a must in order for ssh key to work).
```
chmod 600 id_rsa
```

Now let's login:

```
ssh -i id_rsa kay@<target ip>
```


![](./images/20230908160728.png)

Now that's a problem, this key is password protected, but we can get it using john, more specifically ssh2john, it will generate a hash from the file and then brute force it to find the password, doing so:

![](./images/20230908160903.png)

After generating it, we can put it in a file then feed it to john like this:


![](./images/20230908161028.png)

And boom we have the password for the rsa key, now time to log in.

![](./images/20230908161207.png)

After logging in we are finally able to see the password and submit it, and the machine is done.

thanks for reading!

Good hunting!! :)


---

Written by: Mustafa Musallati.
[LinkedIn](https://www.linkedin.com/in/mustafa-musallati-95a159260/)
[instagram](https://www.instagram.com/accaard/)
